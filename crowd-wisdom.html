<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/x-icon" href="https://www.onlygfx.com/wp-content/uploads/2022/04/brain-icon-3.png">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crowd Wisdom</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rubik&display=swap" rel="stylesheet">
</head>
<body>
    <div id="title">
        <h3 class="mainHeader">üåê Crowd Wisdom üß†</h3>
        <p class="version">v 1.4</p>
    </div>
    <div id="pregame" class="mode">
        <!---p>Enter:</p--->
        <input id="playerNames" placeholder="Dolce,Gabana,MatzaBright..."/><br>
        <input id="creativeQuestion" placeholder="Enter Question Here"/><br>
        <div style="display: none;"><input id="creative" type="checkbox"/><span>use database question</span><br></div>
        <br><br>
        <button class="circle" onclick="startGame()">‚ñ∂Ô∏è</button><br>
        <button onclick="backToStart()">Reset</button>
    </div>
    <div id="game" class="mode">
        <h1 id="question" class="question">#question#</h1>
        <div id="playerInputDiv">
            <h3 id="currentPlayerName">loading...</h3>
            <input id="playerInput" placeholder="make a guess..."/><br>
            <button class="circle" onclick="submitAns()">‚úÖ</button>
        </div>
    </div>
    <div id="postgame_creative" class="mode">
        <p>Average:</p>
        <h1 id="creative_avg">loading...</h1>
        <p id="playersGuesses">
            loading...
        </p>
        <button class="circle" onclick="showAnswer()">üí°</button><br>
        <button onclick="playAgain()">Play Again</button><br>
        <button onclick="backToStart()">Reset</button>
    </div>
    <div id="postgame" class="mode">
        <h3>The Answer Is</h3>
        <h1>#answer#</h1>
        <div class="horizontalDiv">
            <div class="res">
                <span id="avg">69</span><br>
                AVG
            </div>
            <div class="res">
                <span id="dis">69</span><br>
                DIS
            </div>
        </div>
        <p id="gameMsg">loading...</p><br>
        <button onclick="location.reload()">Play Again</button>
    </div>
</body>
<style>

    .version {
        color: #ffd089;
        font-style: italic;
        margin: 0;
    }

    .mainHeader {
        font-size: 2rem;
    }

    .horizontalDiv {
        display: flex;
        justify-content: center;
    }

    .res {
        background-color: #FC9F10;
        padding: 10px;
        border-style: none;
        border-radius: 5px;
        width: fit-content;
        margin: 5px;
        font-weight: bold;
    }

    #title {
        background-color: #FC9F10;
        padding: 5px;
        margin: 0;
        box-shadow: 10px 10px 40px -2px rgba(0,0,0,0.3);
        font-family: 'Rubik', sans-serif;
    }

    .question {
        font-family: 'Rubik', sans-serif;
    }

    .mode {
        margin: 0;
        padding: 20px;
    }

    body {
        text-align: center;
        font-family: 'Rubik', sans-serif;
        margin: 0;
        background-color: rgb(255, 236, 218);
    }

    button {
        font-family: 'Rubik', sans-serif;
        margin-top: 10px;
        padding: 10px;
        font-size: larger;
        background-color: #FC9F10;
        border-style: none;
        border-radius: 5px;
        color: black;
        width: 100px;
        box-shadow: 5px 5px 20px 5px #bdbdbd;
    }

    input {
        font-family: 'Rubik', sans-serif;
        padding: 5px;
        width: 90%;
        font-size: larger;
        border-width: 3px;
        border-color: #FC9F10;
        border-style: solid;
        margin-top: 10px;
        outline: none;
        border-radius: 10px;
        box-shadow: 5px 5px 20px 5px #bdbdbd;
    }

    .inputAnimationA {
        background-color: #FC9F10;
    }

    .inputAnimationB {
        transition-duration: 1s;
        -webkit-animation-duration: 1s;
        background-color: white;
    }

    #game {
        display: none;
    }

    #postgame {
        display: none;
    }

    #postgame_creative {
        display: none;
    }

    .dis {
        font-style: italic;
        color: rgb(47, 255, 134);
    }

    #creative {
        width: auto;
    }

    #creative_avg {
        font-weight: bold;
        font-size: 3rem;
        margin-top: 0px;
    }

    .name {
        color: #FC9F10;
        font-family: 'Rubik', sans-serif;
        font-size: 2rem;
    }

    .playerNameGuess {
        font-weight: bolder;
        color: #FC9F10;
    }

    #playersGuesses {
        font-size: 1.5rem;
    }

    .circle {
        border-radius: 50%;
        width: 100px;
        height: 100px;
        font-size: 2.5rem;
    }

</style>
<script>

    let question = "#question#";
    let answer = parseInt("#answer#");
    let currentPlayerIndex = 0;
    let playersAnswers = [];
    let playerNames = #playerNames#;
    
    const displayShow = 'block';
    
    let GAME_MODE_CREATIVE = true;
    
    if (playerNames != undefined) {
        document.getElementById('playerNames').style.display = 'none';
        document.getElementById('playerNames').value = playerNames; //
    }

    function playAgain() {
        //location.href = /*'http://' +*/ location.hostname + '/' + playerNames.join('&');
        location.assign(location.origin + '/' + playerNames.join('&'));
    }

    function backToStart() {
        //location.href = /*'http://' +*/ location.hostname;
        location.assign(location.origin);
    }

    function showAnswer() {
        openResults(question);
    }

    function createSearchUrlKeywords(keyword) {
        return "https://www.google.com/search?q=" + keyword.replace(' ', '+');
    }

    function openResults(question) {
        open(createSearchUrlKeywords(question));
    }

    function showPlayerNamePlaying(name) {
        let txt = 'Now guessing: <span class="name">' + name + '</span>';
        document.getElementById('currentPlayerName').innerHTML = txt;
    }

    function startGame() {
        const playerNamesElem = document.getElementById('playerNames');
        const questionElem = document.getElementById('creativeQuestion');

        if (playerNamesElem.value != '' && questionElem.value != '')
        {
            let mode_db = document.getElementById('creative').checked;
            GAME_MODE_CREATIVE = !mode_db;
            if (GAME_MODE_CREATIVE) {
                question = questionElem.value;

                // remove all spaces in the end of the question
                while (question.endsWith(' ')) {
                    question = question.substr(0, question.length - 1);
                }

                // add '?' at the end if there isnt one
                if (question.endsWith('?') == false) {
                    question += '?';
                }
            }
            
            document.getElementById('question').innerHTML = question;
            
            if (playerNames == undefined)
                playerNames = playerNamesElem.value.toString().split(',');
            
            playersCount = playerNames.length;

            // switch screens
            document.getElementById('pregame').style.display = 'none';
            document.getElementById('game').style.display = displayShow;

            showPlayerNamePlaying(playerNames[0]);
        }
    }
    
    function submitAns() {
        let temp = document.getElementById('playerInput').value;

        if (temp != '') {    
            // remove all ','
            while (temp.includes(',')) {
                temp = temp.replace(',', '');
            }

            let p_answer = parseInt(temp);
            playersAnswers.push(parseInt(p_answer));

            // check if it is the last player answering
            if (playersCount == undefined) {
                alert('error. player count isnt defind');
                location.reload();
            }

            // last player answering
            if (currentPlayerIndex == playersCount - 1) {
                // last player
                // do avg
                let sum = 0;
                for (let i = 0; i < playersAnswers.length; i++) {
                    sum += playersAnswers[i];
                }

                let avg = parseInt(sum / playersAnswers.length);

                if (GAME_MODE_CREATIVE)
                {
                    document.getElementById('creative_avg').innerHTML = avg;

                    // make name & guess arr
                    let nameAnswerArr = [];
                    for (let i = 0; i < playerNames.length; i++) {
                        nameAnswerArr.push({'name': playerNames[i], 'guess': playersAnswers[i]});
                    }
                    // sort players by answers
                    for (let i = 0; i < nameAnswerArr.length; i++) {
                        for (let j = 0; j < nameAnswerArr.length - i - 1; j++) {
                            if (nameAnswerArr[j].guess > nameAnswerArr[j+1].guess) {
                                // swap
                                let temp = nameAnswerArr[j];
                                nameAnswerArr[j] = nameAnswerArr[j+1];
                                nameAnswerArr[j+1] = temp;
                            }
                        }
                    }
                    // show player's gueeses
                    let txt = '';
                    for (let i = 0; i < nameAnswerArr.length; i++) {
                        txt += '<span class="playerNameGuess">' + nameAnswerArr[i].name + ':</span> ' + nameAnswerArr[i].guess + '<br>';
                    }
                    document.getElementById('playersGuesses').innerHTML = txt;

                    // switch screens
                    document.getElementById('game').style.display = 'none';
                    document.getElementById('postgame_creative').style.display = displayShow;
                }
                else {
                    // find the closest player to the answer
                    let pName;
                    let pAns;
                    
                    let index = 0;
                    let min = Math.abs(playersAnswers[0] - answer);
                    for (let i = 0; i < playersAnswers.length; i++) {
                        let temp = Math.abs(playersAnswers[i] - answer);
                        if (temp < min)
                        {
                            min = temp;
                            index = i;
                        }
                    }

                    pName = playerNames[index];
                    pAns = playersAnswers[index];

                    let distance = parseInt(Math.abs(answer - avg));

                    document.getElementById('avg').innerHTML = avg;
                    document.getElementById('dis').innerHTML = distance;
                    document.getElementById('gameMsg').innerHTML = '<strong>' + pName + '</strong> was the closest with his answer of: ' + pAns;

                    // switch screens
                    document.getElementById('game').style.display = 'none';
                    document.getElementById('postgame').style.display = displayShow;
                }
            }
            else {
                currentPlayerIndex++;
                showPlayerNamePlaying(playerNames[currentPlayerIndex]);
                document.getElementById('playerInput').value = '';
                // input color animation
                document.getElementById('playerInput').className = 'inputAnimationA';
                setTimeout(() => {
                    document.getElementById('playerInput').className = 'inputAnimationB';
                }, 10);
            }
        }

    }
</script>
</html>